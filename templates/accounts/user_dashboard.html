
{% extends "base.html" %}
{% load static %}
{% block head_extra %}
<link rel="stylesheet" href="{% static 'assets/css/user_dashboard.css' %}">
{% endblock %}

{% block content %}
<style>
  body {
    background-color: #0d0d0d;
  }

  h2 {
    color: #ffcc00;
    font-weight: bold;
    text-shadow: 1px 1px #000;
    margin-bottom: 30px;
  }

  .card {
    background-color: #1a1a1a;
    border: 1px solid #333;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(255, 204, 0, 0.1);
  }

  .card-header {
    background-color: #1a1a1a;
    color: #ffcc00;
    font-weight: bold;
    font-size: 1.1rem;
  }

  .card-body {
    color: #f5f5f5;
  }

  .btn-outline-light {
    border-color: #ffaa00;
    color: #ffaa00;
  }

  .btn-outline-light:hover {
    background-color: #ffaa00;
    color: #000;
  }

  .btn-primary {
    background-color: #ffaa00;
    border-color: #ffaa00;
    color: #000;
    font-weight: bold;
  }

  .btn-primary:hover {
    background-color: #ffcc00;
    border-color: #ffcc00;
  }

  .table {
    color: #f5f5f5;
    background-color: #1a1a1a;
  }

  .table th {
    background-color: #0056d2;
    color: white;
  }

  .badge.bg-success {
    background-color: #28a745;
  }

  .badge.bg-warning {
    background-color: #ffc107;
    color: #000;
  }

  .btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
  }

  .btn-secondary:hover {
    background-color: #5a6268;
    border-color: #545b62;
  }

  .mb-3 a.btn {
    margin-bottom: 10px;
  }

  .card-header span {
    display: flex;
    align-items: center;
  }

  .card-header span::before {
    content: "ðŸ“‚";
    margin-right: 8px;
  }

  .card-header:has(span:contains("Your Bookings"))::before {
    content: "ðŸ“‹";
  }

  .card-header:has(span:contains("Profile Info"))::before {
    content: "ðŸ‘¤";
  }
</style>

<h2>ðŸŽ­ Welcome, {{ user.username }}!</h2>

<div class="card mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span>ðŸ‘¤ Profile Info</span>
    <a href="{% url 'profile_settings' %}" class="btn btn-sm btn-outline-light">Edit</a>
  </div>
  <div class="card-body">
    <p><strong>Username:</strong> {{ user.username }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>Phone:</strong> {{ user.userprofile.phone_number|default:"â€”" }}</p>
    <p><strong>Address:</strong> {{ user.userprofile.address|default:"â€”" }}</p>
  </div>
</div>

<div class="mb-3">
  {% for show in shows %}
    <a href="{% url 'book_ticket' show.id %}" class="btn btn-primary">
      ðŸŽŸ Book for {{ show.name }} on {{ show.date }}
    </a>
  {% endfor %}
</div>

<form method="get" class="row g-3 mb-4">
  <div class="col-md-3">
    <input type="date" name="start_date" class="form-control" value="{{ filter_start_date }}">
  </div>
  <div class="col-md-3">
    <input type="date" name="end_date" class="form-control" value="{{ filter_end_date }}">
  </div>
  <div class="col-md-3">
    <select name="status" class="form-select">
      <option value="">All Statuses</option>
      <option value="Paid" {% if filter_status == "Paid" %}selected{% endif %}>Paid</option>
      <option value="Pending" {% if filter_status == "Pending" %}selected{% endif %}>Pending</option>
    </select>
  </div>
  <div class="col-md-3">
    <button type="submit" class="btn btn-secondary w-100">Filter Bookings</button>
  </div>
</form>

<div class="card">
  <div class="card-header"><span>ðŸ“‹ Your Bookings</span></div>
  <div class="card-body p-0">
    {% if bookings %}
      <table class="table table-striped table-hover mb-0">
        <thead>
          <tr>
            <th>Event</th>
            <th>Date</th>
            <th>Tickets</th>
            <th>Total</th>
            <th>Status</th>
            <th>Action</th>
            <th>Download</th>
          </tr>
        </thead>
        <tbody>
          {% for booking in bookings %}
            <tr>
              <td>{{ booking.event_name }}</td>
              <td>{{ booking.event_date }}</td>
              <td>{{ booking.number_of_tickets }}</td>
              <td>â‚¹{{ booking.total_price }}</td>
              <td>
                {% if booking.payment_status == 'Paid' %}
                  <span class="badge bg-success">Paid</span>
                {% else %}
                  <span class="badge bg-warning text-dark">Pending</span>
                {% endif %}
              </td>
              <td>
                {% if booking.payment_status != "Paid" %}
                  <a href="{% url 'payments' booking.id %}" class="btn btn-sm btn-success">Pay</a>
                {% endif %}
              </td>
              <td>
                {% if booking.ticket_id %}
                  <a href="{% url 'download_ticket' booking.ticket.id %}" class="btn btn-sm btn-outline-warning mt-1" target="_blank">Download Ticket</a>
                {% else %}
                  <span class="text-muted small">Ticket not found</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted text-center p-3 mb-0">You haven't made any bookings yet.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
